type Transaction @entity {
    id: ID!
    timestamp: BigInt!
    blockNumber: BigInt!
    events: [Event!]! @derivedFrom(field: "transaction")
}

####################
#     Protocol     #
####################

type Account @entity {
    id: ID!
    # ---------------------------------- state ----------------------------------
    # ---------------------------------- links ----------------------------------
    flowsOwned: [Flow!]! @derivedFrom(field: "owner")
    flowsReceived: [Flow!]! @derivedFrom(field: "recipient")
}

type Token @entity {
    id: ID!
    # underlyingAddress: Bytes! # TODO: Underlying ERC20 address
    # ---------------------------------- state ----------------------------------
    # ---------------------------------- links ----------------------------------
    flows: [Flow!]! @derivedFrom(field: "token")
}

type Flow @entity {
    id: ID!
    # ---------------------------------- state ----------------------------------
    sum: BigDecimal!
    flowRate: BigInt!
    lastUpdate: BigInt!
    # ---------------------------------- links ----------------------------------
    token: Token! #@derivedFrom(field: "flows")
    owner: Account! #@derivedFrom(field: "flowsOwned")
    recipient: Account! #@derivedFrom(field: "flowsReceived")
    events: [FlowUpdated!]! @derivedFrom(field: "flow")
}

#################
#     Events    #
#################

interface Event {
    id: ID!
    transaction: Transaction!
}

type FlowUpdated implements Event @entity {
    id: ID!
    transaction: Transaction!
    flow: Flow!
    oldFlowRate: BigInt!
    flowRate: BigInt!
    sum: BigDecimal!
}
